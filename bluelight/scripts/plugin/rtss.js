var openWriteRTSS=!1;function loadWriteRTSS(){var e;(e=document.createElement("SPAN")).innerHTML=' <img class="img RTSS" alt="writeRTSS" id="writeRTSS" src="../image/icon/black/rtssdraw_OFF.png" width="50" height="50">',getByid("icon-list").appendChild(e),(e=document.createElement("SPAN")).innerHTML='<div id="RtssDiv"\n    style="background-color:#30306044;display:none;float:right;display: none;flex-direction: column;position: absolute;right:15px;top:100px;z-index: 20;"\n    width="100">\n    <div style="background-color:#889292;">\n      <font color="white">Color：</font>\n      <select id="RTSScolorSelect" style="background-color:#929292;font-weight:bold;font-size:16px;">\n        <option class="RTSSColorSelectOption" id="RTSSBlackSelect" style="color: #000000;font-weight:bold;">Black\n        </option>\n        <option class="RTSSColorSelectOption" id="RTSSBlueSelect" style="color: #0000FF;font-weight:bold;"\n          selected="selected">Blue</option>\n        <option class="RTSSColorSelectOption" id="RTSSCyanSelect" style="color: #00FFFF;font-weight:bold;">Cyan\n        </option>\n        <option class="RTSSColorSelectOption" id="RTSSGreenSelect" style="color: #00FF00;font-weight:bold;">Green\n        </option>\n        <option class="RTSSColorSelectOption" id="RTSSMagentaSelect" style="color: #FF00FF;font-weight:bold;">\n          Magenta</option>\n        <option class="RTSSColorSelectOption" id="RTSSRedSelect" style="color: #FF0000;font-weight:bold;">Red\n        </option>\n        <option class="RTSSColorSelectOption" id="RTSSYellowSelect" style="color: #FFFF00;font-weight:bold;"> Yellow\n        </option>\n        <option class="RTSSColorSelectOption" id="RTSSWhiteSelect" style="color: #FFFFFF;font-weight:bold;">White\n        </option>\n      </select>\n      <br />\n      <font color="white">ROIName：</font><input type="text" id="textROIName" value="ROIName" size="8" />\n    </div>\n    <br />\n    <font color="white">StructureSetLabel：</font><input type="text" id="textStructureSetLabel" value="STRUCTURE SET"\n      size="15" />\n    <font color="white">StructureSetName：</font><input type="text" id="textStructureSetName"\n      value="StructureSetName" size="14" />\n    <font color="white">StructureSetDescription：</font><input type="text" id="textStructureSetDescription"\n      value="RT:" size="8" />\n    <font color="white">ObservationNumber：</font><input type="text" id="textObservationNumber" value="1" size="2" />\n    <font color="white">ReferencedROINumber：</font><input type="text" id="textReferencedROINumber" value="1"\n      size="2" />\n    <font color="white">RTROIInterpretedType：</font><input type="text" id="textRTROIInterpretedType" value="ORGAN"\n      size="8" />\n  </div>',getByid("form-group").appendChild(e),getByid("RtssDiv").style.display="none"}function getColorFromRGB(e){return e.split("(")[1].split(")")[0].split(",")}loadWriteRTSS(),window.addEventListener("keydown",(e=>{var t=e.which;if(1==openWriteRTSS&&(46===t||110===t)){for(var n,a=0;a<PatientMark.length;a++)if(PatientMark[a].showName==getByid("textROIName").value){n=PatientMark[a];break}PatientMark.splice(PatientMark.indexOf(n),1),displayMark(),refreshMarkFromSop(GetNowUid().sop)}})),getByid("writeRTSS").onclick=function(){0!=this.enable&&(cancelTools(),openWriteRTSS=!openWriteRTSS,img2darkByClass("RTSS",!openWriteRTSS),openLeftImgClick=!openWriteRTSS,this.src=1==openWriteRTSS?"../image/icon/black/rtssdraw_ON.png":"../image/icon/black/rtssdraw_OFF.png",1==openWriteRTSS?(getByid("RtssDiv").style.display="flex",set_BL_model("writertss"),openWheel=!0,writertss()):getByid("RtssDiv").style.display="none",displayMark(),1!=openWriteRTSS&&(set_RTSS_context(),1==ConfigLog.Xml2Dcm.enableXml2Dcm?function(e,t,n){document.createElement("a");let a=new File([e],t+".xml",{type:"text/plain"});var r=new XMLHttpRequest;r.open("POST",ConfigLog.Xml2Dcm.Xml2DcmUrl,!0),r.setRequestHeader("enctype","multipart/form-data");var i=new FormData;i.append("files",a),r.send(i),r.onload=function(){if(200==r.status){let e=JSON.parse(r.responseText);for(let t of e)window.open(t)}}}(String(get_RTSS_context()),""+CreateSecurePassword()):function(e,t,n){let a=document.createElement("a"),r=new Blob([e],{type:"text/plain"});a.href=window.URL.createObjectURL(r),a.download="filename_RTSS.xml",a.click()}(String(get_RTSS_context())),getByid("MouseOperation").click()))};var RTSS_format='<?xml version="1.0" encoding="UTF-8"?>\n    <file-format>\n        <meta-header xfer="1.2.840.10008.1.2.1" name="Little Endian Explicit">\n            <element tag="0002,0000" vr="UL" vm="1" len="___FileMetaInformationGroupLength(len)___" name="FileMetaInformationGroupLength">___FileMetaInformationGroupLength___</element>\n            <element tag="0002,0001" vr="OB" vm="1" len="2" name="FileMetaInformationVersion" binary="hidden"></element>\n            <element tag="0002,0002" vr="UI" vm="1" len="30" name="MediaStorageSOPClassUID">1.2.840.10008.5.1.4.1.1.481.3</element>\n            <element tag="0002,0003" vr="UI" vm="1" len="___SOPInstanceUID(len)___" name="MediaStorageSOPInstanceUID">___SOPInstanceUID___</element>\n            <element tag="0002,0010" vr="UI" vm="1" len="20" name="TransferSyntaxUID">1.2.840.10008.1.2.1</element>\n            <element tag="0002,0012" vr="UI" vm="1" len="24" name="ImplementationClassUID">2.16.886.119.102568.9</element>\n            <element tag="0002,0013" vr="SH" vm="1" len="10" name="ImplementationVersionName">BlueLight</element>\n        </meta-header>\n        <data-set xfer="1.2.840.10008.1.2.1" name="Little Endian Explicit">\n            <element tag="0004,1430" vr="CS" vm="1" len="6" name="DirectoryRecordType">IMAGE</element>\n            <element tag="0008,0016" vr="UI" vm="1" len="30" name="SOPClassUID">1.2.840.10008.5.1.4.1.1.481.3</element>\n            <element tag="0008,0018" vr="UI" vm="1" len="___SOPInstanceUID(len)___" name="SOPInstanceUID">___SOPInstanceUID___</element>\n            <element tag="0008,0020" vr="DA" vm="1" len="8" name="StudyDate">___StudyDate___</element>\n            <element tag="0008,0030" vr="TM" vm="1" len="6" name="StudyTime">___StudyTime___</element>\n            <element tag="0008,0050" vr="SH" vm="1" len="___AccessionNumber(len)___" name="AccessionNumber">___AccessionNumber___</element>\n            <element tag="0008,0060" vr="CS" vm="1" len="8" name="Modality">RTSTRUCT</element>\n            <element tag="0008,0061" vr="CS" vm="1" len="___ModalitiesInStudy(len)___" name="ModalitiesInStudy">___ModalitiesInStudy___</element>\n            <element tag="0008,0070" vr="LO" vm="1" len="___Manufacturer(len)___" name="Manufacturer">___Manufacturer___</element>\n            <element tag="0008,0080" vr="LO" vm="1" len="___InstitutionName(len)___" name="InstitutionName">___InstitutionName___</element>\n            <element tag="0008,0081" vr="ST" vm="1" len="___InstitutionAddress(len)___" name="InstitutionAddress">___InstitutionAddress___</element>\n            <element tag="0008,0090" vr="PN" vm="1" len="___ReferringPhysicianName(len)___" name="ReferringPhysicianName">___ReferringPhysicianName___</element>\n            <element tag="0008,1010" vr="SH" vm="1" len="___StationName(len)___" name="StationName">___StationName___</element>\n            <element tag="0008,1030" vr="LO" vm="1" len="___StudyDescription(len)___" name="StudyDescription">___StudyDescription___</element>\n            <element tag="0008,103e" vr="LO" vm="1" len="___SeriesDescription(len)___" name="SeriesDescription">___SeriesDescription___</element>\n            <sequence tag="0008,1110" vr="SQ" card="1" name="ReferencedStudySequence">\n                <item card="2">\n                    <element tag="0008,1150" vr="UI" vm="1" len="24" name="ReferencedSOPClassUID">1.2.840.10008.3.1.2.3.1</element>\n                    <element tag="0008,1155" vr="UI" vm="1" len="___ReferencedSOPInstanceUID(len)___" name="ReferencedSOPInstanceUID">___ReferencedSOPInstanceUID___</element>\n                </item>\n            </sequence>\n            <element tag="0010,0010" vr="PN" vm="1" len="___PatientName(len)___" name="PatientName">___PatientName___</element>\n            <element tag="0010,0020" vr="LO" vm="1" len="___PatientID(len)___" name="PatientID">___PatientID___</element>\n            <element tag="0020,000d" vr="UI" vm="1" len="___StudyInstanceUID(len)___" name="StudyInstanceUID">___StudyInstanceUID___</element>\n            <element tag="0020,000e" vr="UI" vm="1" len="___SeriesInstanceUID(len)___" name="SeriesInstanceUID">___SeriesInstanceUID___</element>\n            <element tag="0020,0010" vr="SH" vm="1" len="___StudyID(len)___" name="StudyID">___StudyID___</element>\n            <element tag="0020,0011" vr="IS" vm="1" len="___SeriesNumber(len)___" name="SeriesNumber">___SeriesNumber___</element>\n            <element tag="0032,1032" vr="PN" vm="1" len="___RequestingPhysician(len)___" name="RequestingPhysician">___RequestingPhysician___</element>\n            <element tag="01e1,1040" vr="UI" vm="1" len="___StudyInstanceUID(len)___" name="Unknown Tag &amp; Data">___StudyInstanceUID___</element>\n            <element tag="3006,0002" vr="SH" vm="1" len="___StructureSetLabel(len)___" name="StructureSetLabel">___StructureSetLabel___</element>\n            <element tag="3006,0004" vr="LO" vm="1" len="___StructureSetName(len)___" name="StructureSetName">___StructureSetName___</element>\n            <element tag="3006,0006" vr="ST" vm="1" len="___StructureSetDescription(len)___" name="StructureSetDescription">___StructureSetDescription___</element>\n            <element tag="3006,0008" vr="DA" vm="1" len="8" name="StructureSetDate">___StudyDate___</element>\n            <element tag="3006,0009" vr="TM" vm="1" len="14" name="StructureSetTime">___StudyTime___</element>\n            <sequence tag="3006,0010" vr="SQ" card="1" name="ReferencedFrameOfReferenceSequence">\n                <item card="2">\n                    <element tag="0020,0052" vr="UI" vm="1" len="54" name="FrameOfReferenceUID">1.2.840.113619.2.222.3596.375084.15213.1536104832.466</element>\n                    <sequence tag="3006,0012" vr="SQ" card="1" name="RTReferencedStudySequence">\n                        <item card="3">\n                            <element tag="0008,1150" vr="UI" vm="1" len="26" name="ReferencedSOPClassUID">1.2.840.10008.5.1.4.1.1.4</element>\n                            <element tag="0008,1155" vr="UI" vm="1" len="___ReferencedStudyInstanceUID(len)___" name="ReferencedSOPInstanceUID">___ReferencedStudyInstanceUID___</element>\n                            <sequence tag="3006,0014" vr="SQ" card="1" name="RTReferencedSeriesSequence">\n                                <item card="2">\n                                    <element tag="0020,000e" vr="UI" vm="1" len="___ReferencedSeriesInstanceUID(len)___" name="SeriesInstanceUID">___ReferencedSeriesInstanceUID___</element>\n                                    <sequence tag="3006,0016" vr="SQ" card="24" name="ContourImageSequence">\n___item2___\n                                    </sequence>\n                                </item>\n                            </sequence>\n                        </item>\n                    </sequence>\n                </item>\n            </sequence>\n            <sequence tag="3006,0020" vr="SQ" card="1" name="StructureSetROISequence">                 \n___item4___               \n            </sequence>\n            <sequence tag="3006,0039" vr="SQ" card="1" name="ROIContourSequence">\n            <item card="3">\n            <element tag="3006,002a" vr="IS" vm="3" len="___ROIDisplayColor(len)___" name="ROIDisplayColor">___ROIDisplayColor___</element>\n                <sequence tag="3006,0040" vr="SQ" card="5" name="ContourSequence">      \n                    \n___item6___\n                </sequence>\n            <element tag="3006,0084" vr="IS" vm="1" len="2" name="ReferencedROINumber">1</element>\n            </item>      \n\n            </sequence>\n            <sequence tag="3006,0080" vr="SQ" card="1" name="RTROIObservationsSequence">\n                <item card="3">\n                    <element tag="3006,0082" vr="IS" vm="1" len="___ObservationNumber(len)___" name="ObservationNumber">___ObservationNumber___</element>\n                    <element tag="3006,0084" vr="IS" vm="1" len="___ReferencedROINumber(len)___" name="ReferencedROINumber">___ReferencedROINumber___</element>\n                    <element tag="3006,00a4" vr="CS" vm="1" len="___RTROIInterpretedType(len)___" name="RTROIInterpretedType">___RTROIInterpretedType___</element>\n                </item>\n            </sequence>\n        </data-set>\n    </file-format>\n    ',RTSS_format_object_list=[],RTSS_format_tail_2='\n                                        <item card="2">\n                                            <element tag="0008,1150" vr="UI" vm="1" len="26" name="ReferencedSOPClassUID">1.2.840.10008.5.1.4.1.1.4</element>\n                                            <element tag="0008,1155" vr="UI" vm="1" len="___ReferencedSOPInstanceUID(len)___" name="ReferencedSOPInstanceUID">___ReferencedSOPInstanceUID___</element>\n                                        </item>',RTSS_format_tail_4='\n                <item card="4">\n                    <element tag="3006,0022" vr="IS" vm="1" len="2" name="ROINumber">1</element>\n                    <element tag="3006,0024" vr="UI" vm="1" len="2" name="ReferencedFrameOfReferenceUID">0</element>\n                    <element tag="3006,0026" vr="LO" vm="1" len="___ROIName(len)___" name="ROIName">___ROIName___</element>\n                    <element tag="3006,0036" vr="CS" vm="1" len="6" name="ROIGenerationAlgorithm">MANUAL</element>\n                </item>\n',RTSS_format_tail_6='\n\n                            <item card="6">\n                                <sequence tag="3006,0016" vr="SQ" card="1" name="ContourImageSequence">\n                                    <item card="2">\n                                        <element tag="0008,1150" vr="UI" vm="1" len="26" name="ReferencedSOPClassUID">1.2.840.10008.5.1.4.1.1.4</element>\n                                        <element tag="0008,1155" vr="UI" vm="1" len="___ReferencedSOPInstanceUID(len)___" name="ReferencedSOPInstanceUID">___ReferencedSOPInstanceUID___</element>\n                                    </item>\n                                </sequence>\n                                <element tag="3006,0042" vr="CS" vm="1" len="14" name="ContourGeometricType">CLOSED_PLANAR</element>\n                                <element tag="3006,0044" vr="DS" vm="1" len="2" name="ContourSlabThickness">5</element>\n                                <element tag="3006,0046" vr="IS" vm="1" len="___NumberOfContourPoints(len)___" name="NumberOfContourPoints">___NumberOfContourPoints___</element>\n                                <element tag="3006,0048" vr="IS" vm="1" len="___ContourNumber(len)___" name="ContourNumber">___ContourNumber___</element>\n                                <element tag="3006,0050" vr="DS" vm="___vm___" len="___len___" name="ContourData">___ContourData___</element>\n                            </item>\n                        ',RTSS_now_choose=null,temp_xml_format="";function RTSS_pounch(e,t,n){let a=4*getMarkSize(GetViewportMark(),!1),r=SearchUid2Index(GetViewport().sop),i=r[0],_=r[1],o=r[2];for(var l=0;l<PatientMark.length;l++)if((!n||PatientMark[l]==n)&&PatientMark[l].sop==Patient.Study[i].Series[_].Sop[o].SopUID)for(var m=0;m<PatientMark[l].mark.length;m++)if("POLYLINE"==PatientMark[l].mark[m].type){for(var s=PatientMark[l].mark[m],c=-999999,S=-999999,u=999999,d=999999,p=[],g=[],I=[],v=[],f=0;f<PatientMark[l].mark[m].markX.length;f+=1)parseInt(s.markX[f])>=c&&(c=parseInt(s.markX[f])),parseInt(s.markX[f])<=u&&(u=parseInt(s.markX[f]));for(f=0;f<PatientMark[l].mark[m].markX.length;f+=1)equal_TOL(c,parseInt(s.markX[f]),a)&&p.push(f),equal_TOL(u,parseInt(s.markX[f]),a)&&I.push(f);for(f=0;f<PatientMark[l].mark[m].markY.length;f+=1)parseInt(s.markY[f])>=S&&(S=parseInt(s.markY[f])),parseInt(s.markY[f])<=d&&(d=parseInt(s.markY[f]));for(f=0;f<PatientMark[l].mark[m].markX.length;f+=1)equal_TOL(S,parseInt(s.markY[f]),a)&&g.push(f),equal_TOL(d,parseInt(s.markY[f]),a)&&v.push(f);for(f=0;f<PatientMark[l].mark[m].markX.length-1;f+=1){var R=(parseInt(s.markX[f])+parseInt(s.markX[f+1]))/2,h=(parseInt(s.markY[f])+parseInt(s.markY[f+1]))/2;if(t+a>=h&&e+a>=R&&t<h+a&&e<R+a){if(equal_TOL(h,S,a))return Graphic_now_choose={reference:PatientMark[l],point:g,mark:s,middle:[(c+u)/2,(S+d)/2],value:"up"},!0;if(equal_TOL(h,d,a))return Graphic_now_choose={reference:PatientMark[l],point:v,mark:s,middle:[(c+u)/2,(S+d)/2],value:"down"},!0;if(equal_TOL(R,u,a))return Graphic_now_choose={reference:PatientMark[l],point:I,mark:s,middle:[(c+u)/2,(S+d)/2],value:"left"},!0;if(equal_TOL(R,c,a))return Graphic_now_choose={reference:PatientMark[l],point:p,mark:s,middle:[(c+u)/2,(S+d)/2],value:"right"},!0}}}return Graphic_now_choose=null,!1}function set_RTSS_context(){RTSS_format_object_list=[];let e="",t="",n="",a="";var r=GetViewport();let i=SearchUid2Index(r.sop),_=i[0],o=i[1];function l(e,t,n,a){n=""+(n=Null2Empty(n)),e=e.replace("___"+t+"___",""+n);var r=(""+n).length;return r%2!=0&&r++,1==a&&(e=e.replace("___"+t+"(len)___",r)),e}i[2],e=""+RTSS_format;for(var m=getAllSop(),s=0;s<m.length;s++){let e=""+RTSS_format_tail_2;e=l(e,"ReferencedSOPInstanceUID",m[s],!0),n+=e}for(var c=0;c<PatientMark.length;c++){if(PatientMark[c].series==Patient.Study[_].Series[o].SeriesUID)for(var S=0;S<PatientMark[c].mark.length;S++)if("RTSS"==PatientMark[c].mark[S].type){var u=""+RTSS_format_tail_6,d=""+RTSS_format_tail_4;d=l(d,"ROIName",PatientMark[c].showName,!0);for(var p=PatientMark[c].mark[S],g="",I=0;I<p.markX.length;I+=1){var v=0,f=0;[v,f]=[p.markX[I],p.markY[I]],0!=I&&(g+="\\"),g+=(v=parseFloat(v))+"\\"+(f=parseFloat(f))+"\\"+PatientMark[c].imagePositionZ}u=l(u=(u=(u=u.replace("___ContourData___",g)).replace("___vm___",""+3*p.markX.length)).replace("___len___",3*p.markX.length*16),"NumberOfContourPoints",p.markX.length,!0),u=l(u,"ContourNumber",c+1,!0),u=l(u,"ReferencedSOPInstanceUID",PatientMark[c].sop,!0);var R=getColorFromRGB(PatientMark[c].color);t+=u=l(u,"ROIDisplayColor",R[0]+"\\"+R[1]+"\\"+R[2],!0),a+=d}for(var h=CreateUid("sop"),y=CreateUid("series"),O=0;O<5;O++){e=l(e,"StudyDate",r.StudyDate,!0),e=l(e,"StudyTime",r.StudyTime,!0),e=l(e,"StudyInstanceUID",Patient.Study[_].StudyUID,!0),e=l(e,"SeriesInstanceUID",y,!0),e=l(e,"SOPInstanceUID",h,!0),e=l(e,"PatientID",r.PatientID,!0),e=l(e,"PatientName",r.PatientName,!0),e=l(e,"ReferencedSOPInstanceUID",PatientMark[c].sop,!0),e=l(e,"ReferencedSeriesInstanceUID",Patient.Study[_].Series[o].SeriesUID,!0),e=l(e,"ReferencedStudyInstanceUID",Patient.Study[_].StudyUID,!0),e=l(e,"AccessionNumber",r.AccessionNumber,!0),e=l(e,"StudyDescription",r.StudyDescription,!0),e=l(e,"StudyID",r.StudyID,!0),e=l(e,"ModalitiesInStudy",r.ModalitiesInStudy,!0),e=l(e,"Manufacturer",r.Manufacture,!0),e=l(e,"InstitutionName",r.InstitutionName,!0),e=l(e,"InstitutionAddress",r.InstitutionAddress,!0),e=l(e,"ReferringPhysicianName",r.ReferringPhysicianName,!0),e=l(e,"StationName",r.StationName,!0),e=l(e,"SeriesDescription",r.SeriesDescription,!0),e=l(e,"SeriesNumber",r.SeriesNumber+"01",!0),e=l(e,"RequestingPhysician",""+r.RequestingPhysician,!0),e=l(e,"StructureSetLabel",getByid("textStructureSetLabel").value,!0),e=l(e,"StructureSetName",getByid("textStructureSetName").value,!0),e=l(e,"StructureSetDescription",getByid("textStructureSetDescription").value,!0),e=l(e,"ObservationNumber",getByid("textObservationNumber").value,!0),e=l(e,"ReferencedROINumber",getByid("textReferencedROINumber").value,!0),e=l(e,"RTROIInterpretedType",getByid("textRTROIInterpretedType").value,!0);for(var T=[0,0,128],P=0;P<getClass("RTSSColorSelectOption").length;P++)1==getClass("RTSSColorSelectOption")[P].selected&&(T=getColorFromRGB(getClass("RTSSColorSelectOption")[P].style.color));e=l(e,"ROIDisplayColor",T[0]+"\\"+T[1]+"\\"+T[2],!0),e=l(e,"FileMetaInformationGroupLength",""+(52+(84+h.length)),!0)}}e=e.replace("___item6___",t),e=e.replace("___item2___",n),e=e.replace("___item4___",a),RTSS_format_object_list.push(e)}function get_RTSS_context(){for(var e="",t=0;t<RTSS_format_object_list.length;t++)e+=RTSS_format_object_list[t];return e}function writertss(){"writertss"==BL_mode&&(DeleteMouseEvent(),Mousedown=function(e){1==e.which?MouseDownCheck=!0:3==e.which&&(rightMouseDown=!0),getCurrPoint(e)[0],getCurrPoint(e)[1];var t=GetViewport();if(windowMouseX=GetmouseX(e),windowMouseY=GetmouseY(e),t.originalPointX=getCurrPoint(e)[0],t.originalPointY=getCurrPoint(e)[1],!rightMouseDown){var n=rotateCalculation(e),a=Math.floor(n[0]),r=Math.floor(n[1]),i=a,_=r;t.imageOrientationX&&t.imageOrientationY&&t.imageOrientationZ&&(i=a*t.imageOrientationX+r*-t.imageOrientationY+0,_=a*-t.imageOrientationX2+r*t.imageOrientationY2+0,t.openHorizontalFlip!=t.openVerticalFlip&&(i-=2*(i-a),_-=2*(_-r))),i=i/t.PixelSpacingX+t.imagePositionX,_=_/t.PixelSpacingY+t.imagePositionY;let c=GetNowUid();var o={};o.study=c.study,o.series=c.sreies,o.color="rgb(0,0,128)";for(var l=0;l<getClass("RTSSColorSelectOption").length;l++)1==getClass("RTSSColorSelectOption")[l].selected&&(o.color=getClass("RTSSColorSelectOption")[l].style.color);o.imagePositionZ=t.imagePositionZ,o.mark=[],o.showName=getByid("textROIName").value,o.hideName=o.showName,o.mark.push({}),o.sop=c.sop;var m=o.mark.length-1;o.mark[m].type="RTSS",o.mark[m].markX=[],o.mark[m].markY=[],o.mark[m].markX.push(n[0]-Math.abs(i-n[0])),o.mark[m].markY.push(n[1]-Math.abs(_-n[1])),PatientMark.push(o),refreshMark(o),RTSS_now_choose=o.mark[m];for(var s=0;s<Viewport_Total;s++)displayMark(s)}},Mousemove=function(e){var t=getCurrPoint(e)[0],n=getCurrPoint(e)[1],a=GetViewport(),r=getClass("labelXY");{let t=rotateCalculation(e);r[viewportNumber].innerText="X: "+parseInt(t[0])+" Y: "+parseInt(t[1])}if(1==rightMouseDown&&scale_size(e,t,n),1==openLink)for(var i=0;i<Viewport_Total;i++)GetViewport(i).newMousePointX=a.newMousePointX,GetViewport(i).newMousePointY=a.newMousePointY;for(putLabel(),i=0;i<Viewport_Total;i++)displayRuler(i);if(!rightMouseDown&&RTSS_now_choose){let t=GetNowUid();var _=rotateCalculation(e),o=Math.floor(_[0]),l=Math.floor(_[1]),m=o,s=l;for(a.imageOrientationX&&a.imageOrientationY&&a.imageOrientationZ&&(m=o*a.imageOrientationX+l*-a.imageOrientationY+0,s=o*-a.imageOrientationX2+l*a.imageOrientationY2+0,a.openHorizontalFlip!=a.openVerticalFlip&&(m-=2*(m-o),s-=2*(s-l))),m=m/a.PixelSpacingX+a.imagePositionX,s=s/a.PixelSpacingY+a.imagePositionY,RTSS_now_choose.markX.push(_[0]-Math.abs(m-_[0])),RTSS_now_choose.markY.push(_[1]-Math.abs(s-_[1])),refreshMark(t.sop),i=0;i<Viewport_Total;i++)displayMark(i)}},Mouseup=function(e){getCurrPoint(e)[0],getCurrPoint(e)[1],MouseDownCheck=!1,rightMouseDown=!1,RTSS_now_choose&&(RTSS_now_choose=null)},AddMouseEvent())}