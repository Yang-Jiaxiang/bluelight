function rotate(){"rotate"==BL_mode&&(DeleteMouseEvent(),openRotate=!0,openChangeFile=!0,set_BL_model.onchange1=function(){openRotate=!1,openChangeFile=!1,set_BL_model.onchange1=function(){return 0}},Mousedown=function(e){1==e.which?MouseDownCheck=!0:3==e.which&&(rightMouseDown=!0),windowMouseX=GetmouseX(e),windowMouseY=GetmouseY(e),GetViewport().originalPointX=getCurrPoint(e)[0],GetViewport().originalPointY=getCurrPoint(e)[1]},Mousemove=function(e){var t=getCurrPoint(e)[0],o=getCurrPoint(e)[1],i=getClass("labelXY");{let t=rotateCalculation(e);i[viewportNumber].innerText="X: "+parseInt(t[0])+" Y: "+parseInt(t[1])}if(1==rightMouseDown&&(Math.abs(o-GetViewport().originalPointY)>Math.abs(t-GetViewport().originalPointX)&&(o<GetViewport().originalPointY-3?GetViewport().rotateValue+=2:o>GetViewport().originalPointY+3&&(GetViewport().rotateValue-=2)),setTransform(),1==openLink))for(var r=0;r<4;r++)GetViewport(r).rotateValue=GetViewport().rotateValue,setTransform(r);if(1==openLink)for(var n=0;n<Viewport_Total;n++)GetViewport(n).newMousePointX=GetViewport().newMousePointX,GetViewport(n).newMousePointY=GetViewport().newMousePointY;for(putLabel(),n=0;n<Viewport_Total;n++)displayRuler(n);if(MouseDownCheck){var a=GetmouseX(e),s=GetmouseY(e);if(GetViewport().newMousePointX+=a-windowMouseX,GetViewport().newMousePointY+=s-windowMouseY,setTransform(),windowMouseX=GetmouseX(e),windowMouseY=GetmouseY(e),1==openLink)for(n=0;n<Viewport_Total;n++)try{GetViewportMark(n).style.width=GetViewport(n).canvas().style.width=GetViewport().canvas().style.width,GetViewportMark(n).style.height=GetViewport(n).canvas().style.height=GetViewport().canvas().style.height,setTransform(n),GetViewport(n).newMousePointX=GetViewport().newMousePointX,GetViewport(n).newMousePointX=GetViewport().newMousePointX}catch(e){}for(putLabel(),n=0;n<Viewport_Total;n++)displayRuler(n)}GetViewport().originalPointX=t,GetViewport().originalPointY=o},Mouseup=function(e){if(getCurrPoint(e)[0],getCurrPoint(e)[1],1==openMouseTool&&1==rightMouseDown&&displayMark(),MouseDownCheck=!1,rightMouseDown=!1,magnifierDiv.style.display="none",openLink)for(var t=0;t<Viewport_Total;t++)displayRuler(t)},Touchstart=function(e,t){t?rightTouchDown=!0:TouchDownCheck=!0,windowMouseX=GetmouseX(e),windowMouseY=GetmouseY(e),1==rightTouchDown&&t&&(windowMouseX2=GetmouseX(t),windowMouseY2=GetmouseY(t)),GetViewport().originalPointX=getCurrPoint(e)[0],GetViewport().originalPointY=getCurrPoint(e)[1],1==rightTouchDown&&t&&(GetViewport().originalPointX2=getCurrPoint(t)[0],GetViewport().originalPointY2=getCurrPoint(t)[1])},Touchmove=function(e,t){var o=GetViewport().canvas();if(!openDisplayMarkup||!getByid("DICOMTagsSelect").selected&&!getByid("AIMSelect").selected){var i=getCurrPoint(e)[0],r=getCurrPoint(e)[1];if(t)var n=getCurrPoint(t)[0],a=getCurrPoint(t)[1];if(getClass("labelXY")[viewportNumber].innerText="X: "+Math.floor(i)+" Y: "+Math.floor(r),1==rightTouchDown&&t){if(1==openLink)for(var s=0;s<Viewport_Total;s++)if(s!=viewportNumber)try{GetViewport(s).canvas().style.width=GetViewport().canvas().style.width,GetViewport(s).canvas().style.height=GetViewport().canvas().style.height,setTransform(s),GetViewport(s).NowCanvasSizeWidth=parseFloat(o.style.width),GetViewport(s).NowCanvasSizeHeight=parseFloat(o.style.height)}catch(e){}if(Math.abs(GetmouseY(t)-GetmouseY(e))-2>Math.abs(windowMouseY-windowMouseY2)+2||Math.abs(GetmouseX(t)-GetmouseX(e))-2>Math.abs(windowMouseX-windowMouseX2)+2){var w=parseFloat(o.style.width),p=parseFloat(o.style.height),u=GetViewportMark().style.width=o.style.width=1.05*w+"px",l=GetViewportMark().style.height=o.style.height=1.05*p+"px";parseFloat(u),GetViewport().newMousePointX-=Math.abs(w-parseFloat(u))/2,parseFloat(l),GetViewport().newMousePointY-=Math.abs(p-parseFloat(l))/2,setTransform()}else(Math.abs(GetmouseY(t)-GetmouseY(e))+2<Math.abs(windowMouseY-windowMouseY2)-2||Math.abs(GetmouseX(t)-GetmouseX(e))+2<Math.abs(windowMouseX-windowMouseX2)-2)&&(w=parseFloat(o.style.width),p=parseFloat(o.style.height),u=GetViewportMark().style.width=o.style.width=w/1.05+"px",l=GetViewportMark().style.height=o.style.height=p/1.05+"px",parseFloat(u),GetViewport().newMousePointX+=Math.abs(w-parseFloat(u))/2,parseFloat(l),GetViewport().newMousePointY+=Math.abs(p-parseFloat(l))/2,setTransform());if(windowMouseX=GetmouseX(e),windowMouseY=GetmouseY(e),windowMouseX2=GetmouseX(t),windowMouseY2=GetmouseY(t),GetViewport().NowCanvasSizeWidth=parseFloat(o.style.width),GetViewport().NowCanvasSizeHeight=parseFloat(o.style.height),1==openLink)for(s=0;s<Viewport_Total;s++)s!=viewportNumber&&(GetViewportMark(s).style.width=GetViewport(s).canvas().style.width=GetViewport().canvas().style.width,GetViewportMark(s).style.height=GetViewport(s).canvas().style.height=GetViewport().canvas().style.height,setTransform(s),GetViewport(s).NowCanvasSizeWidth=parseFloat(o.style.width),GetViewport(s).NowCanvasSizeHeight=parseFloat(o.style.height));if(1==openRotate&&(Math.abs(r-GetViewport().originalPointY)>Math.abs(i-GetViewport().originalPointX)&&Math.abs(a-GetViewport().originalPointY2)>Math.abs(n-GetViewport().originalPointX2)&&(r<GetViewport().originalPointY-3?GetViewport().rotateValue+=2:r>GetViewport().originalPointY+3&&(GetViewport().rotateValue-=2)),setTransform(),1==openLink))for(var h=0;h<Viewport_Total;h++)rotateValue[h]=GetViewport().rotateValue,setTransform(h)}if(0==rightTouchDown&&0==openChangeFile){var G=GetmouseX(e),V=GetmouseY(e);if(GetViewport().newMousePointX+=G-windowMouseX,GetViewport().newMousePointY+=V-windowMouseY,setTransform(),windowMouseX=GetmouseX(e),windowMouseY=GetmouseY(e),1==openLink)for(s=0;s<Viewport_Total;s++)GetViewportMark(s).style.width=GetViewport(s).canvas().style.width=GetViewport().canvas().style.width,GetViewportMark(s).style.height=GetViewport(s).canvas().style.height=GetViewport().canvas().style.height,setTransform(s),newMousePointX[s]=GetViewport().newMousePointX,newMousePointX[s]=GetViewport().newMousePointX;for(putLabel(),s=0;s<Viewport_Total;s++)displayRuler(s)}}},Touchend=function(e,t){1==TouchDownCheck&&(1==openAngle?openAngle=2:2==openAngle&&(openAngle=3)),TouchDownCheck=!1,rightTouchDown=!1,magnifierDiv.style.display="none"},AddMouseEvent())}