import CharLS from"../../codecs/charLS-FixedMemory-browser.js";let charLS;function jpegLSDecode(e,r){const a=charLS._malloc(e.length);charLS.writeArrayToMemory(e,a);const t=charLS._malloc(4),c=charLS._malloc(4),l=charLS._malloc(4),i=charLS._malloc(4),h=charLS._malloc(4),o=charLS._malloc(4),n=charLS._malloc(4),S=charLS._malloc(4),L=charLS._malloc(4),d={result:charLS.ccall("jpegls_decode","number",["number","number","number","number","number","number","number","number","number","number","number"],[a,e.length,t,c,l,i,h,o,S,n,L]),width:charLS.getValue(l,"i32"),height:charLS.getValue(i,"i32"),bitsPerSample:charLS.getValue(h,"i32"),stride:charLS.getValue(o,"i32"),components:charLS.getValue(S,"i32"),allowedLossyError:charLS.getValue(n,"i32"),interleaveMode:charLS.getValue(L,"i32"),pixelData:void 0},m=charLS.getValue(t,"*");return d.bitsPerSample<=8?(d.pixelData=new Uint8Array(d.width*d.height*d.components),d.pixelData.set(new Uint8Array(charLS.HEAP8.buffer,m,d.pixelData.length))):r?(d.pixelData=new Int16Array(d.width*d.height*d.components),d.pixelData.set(new Int16Array(charLS.HEAP16.buffer,m,d.pixelData.length))):(d.pixelData=new Uint16Array(d.width*d.height*d.components),d.pixelData.set(new Uint16Array(charLS.HEAP16.buffer,m,d.pixelData.length))),charLS._free(a),charLS._free(m),charLS._free(t),charLS._free(c),charLS._free(l),charLS._free(i),charLS._free(h),charLS._free(o),charLS._free(S),charLS._free(L),d}function initializeJPEGLS(){if(void 0===CharLS)throw new Error("No JPEG-LS decoder loaded");if(!charLS&&(charLS=CharLS(),!charLS||!charLS._jpegls_decode))throw new Error("JPEG-LS failed to initialize")}function decodeJPEGLS(e,r){initializeJPEGLS();const a=jpegLSDecode(r,1===e.pixelRepresentation);if(0!==a.result&&6!==a.result)throw new Error(`JPEG-LS decoder failed to decode frame (error code ${a.result})`);return e.columns=a.width,e.rows=a.height,e.pixelData=a.pixelData,e}export default decodeJPEGLS;export{initializeJPEGLS};