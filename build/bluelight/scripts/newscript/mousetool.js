function setTransform(e){var t=GetViewport();if(null==e)GetViewportMark().style.transform="translate("+Fpx(t.newMousePointX)+","+Fpx(t.newMousePointY)+")rotate("+t.rotateValue+"deg)",t.canvas().style.transform="translate("+Fpx(t.newMousePointX)+","+Fpx(t.newMousePointY)+")rotate("+t.rotateValue+"deg)";else{var o=e;GetViewportMark(o).style.transform="translate("+Fpx(GetViewport(o).newMousePointX)+","+Fpx(GetViewport(o).newMousePointY)+")rotate("+GetViewport(o).rotateValue+"deg)",GetViewport(o).canvas().style.transform="translate("+Fpx(GetViewport(o).newMousePointX)+","+Fpx(GetViewport(o).newMousePointY)+")rotate("+GetViewport(o).rotateValue+"deg)"}}function scale_size(e,t,o){var s=GetViewport(),i=s.canvas();if(1==openLink)for(var a=0;a<Viewport_Total;a++)if(a!=viewportNumber)try{GetViewport(a).canvas().style.width=i.style.width,GetViewport(a).canvas().style.height=i.style.height,setTransform(a),GetViewport(a).NowCanvasSizeWidth=parseFloat(i.style.width),GetViewport(a).NowCanvasSizeHeight=parseFloat(i.style.height)}catch(e){}if(GetmouseY(e)<windowMouseY-2){var r=parseFloat(i.style.width),n=parseFloat(i.style.height),w=GetViewportMark().style.width=i.style.width=1.05*r+"px",l=GetViewportMark().style.height=i.style.height=1.05*n+"px";parseFloat(w),s.newMousePointX-=Math.abs(r-parseFloat(w))/2,parseFloat(l),s.newMousePointY-=Math.abs(n-parseFloat(l))/2,setTransform()}else GetmouseY(e)>windowMouseY+2&&(r=parseFloat(i.style.width),n=parseFloat(i.style.height),w=GetViewportMark().style.width=i.style.width=r/1.05+"px",l=GetViewportMark().style.height=i.style.height=n/1.05+"px",parseFloat(w),s.newMousePointX+=Math.abs(r-parseFloat(w))/2,parseFloat(l),s.newMousePointY+=Math.abs(n-parseFloat(l))/2,setTransform());if(windowMouseX=GetmouseX(e),windowMouseY=GetmouseY(e),s.NowCanvasSizeWidth=parseFloat(i.style.width),s.NowCanvasSizeHeight=parseFloat(i.style.height),1==openLink)for(a=0;a<Viewport_Total;a++)a!=viewportNumber&&(GetViewportMark(a).style.width=GetViewport(a).canvas().style.width=i.style.width,GetViewportMark(a).style.height=GetViewport(a).canvas().style.height=i.style.height,setTransform(a),GetViewport(a).NowCanvasSizeWidth=parseFloat(i.style.width),GetViewport(a).NowCanvasSizeHeight=parseFloat(i.style.height))}function mouseTool(){"MouseTool"==BL_mode&&(DeleteMouseEvent(),openMouseTool=!0,set_BL_model.onchange1=function(){openMouseTool=!1,set_BL_model.onchange1=function(){return 0}},Mousedown=function(e){1==e.which?MouseDownCheck=!0:3==e.which&&(rightMouseDown=!0),windowMouseX=GetmouseX(e),windowMouseY=GetmouseY(e),GetViewport().originalPointX=getCurrPoint(e)[0],GetViewport().originalPointY=getCurrPoint(e)[1]},Mousemove=function(e){var t=GetViewport(),o=(t.canvas(),getCurrPoint(e)[0]),s=getCurrPoint(e)[1],i=getClass("labelXY");{let t=rotateCalculation(e);i[viewportNumber].innerText="X: "+parseInt(t[0])+" Y: "+parseInt(t[1])}if(1==rightMouseDown&&scale_size(e,o,s),1==openLink)for(var a=0;a<Viewport_Total;a++)GetViewport(a).newMousePointX=t.newMousePointX,GetViewport(a).newMousePointY=t.newMousePointY;for(putLabel(),a=0;a<Viewport_Total;a++)displayRuler(a);if(MouseDownCheck){var r=GetmouseX(e),n=GetmouseY(e);if(t.newMousePointX+=r-windowMouseX,t.newMousePointY+=n-windowMouseY,setTransform(),windowMouseX=GetmouseX(e),windowMouseY=GetmouseY(e),1==openLink)for(a=0;a<Viewport_Total;a++)try{GetViewportMark(a).style.width=GetViewport(a).canvas().style.width=t.canvas().style.width,GetViewportMark(a).style.height=GetViewport(a).canvas().style.height=t.canvas().style.height,setTransform(a),GetViewport(a).newMousePointX=t.newMousePointX,GetViewport(a).newMousePointX=t.newMousePointX}catch(e){}for(putLabel(),a=0;a<Viewport_Total;a++)displayRuler(a)}},Mouseup=function(e){if(getCurrPoint(e)[0],getCurrPoint(e)[1],1==openMouseTool&&1==rightMouseDown&&displayMark(),MouseDownCheck=!1,rightMouseDown=!1,magnifierDiv.style.display="none",openLink)for(var t=0;t<Viewport_Total;t++)displayRuler(t)},Touchstart=function(e,t){var o=GetViewport();o.canvas(),t?rightTouchDown=!0:TouchDownCheck=!0,windowMouseX=GetmouseX(e),windowMouseY=GetmouseY(e),1==rightTouchDown&&t&&(windowMouseX2=GetmouseX(t),windowMouseY2=GetmouseY(t)),o.originalPointX=getCurrPoint(e)[0],o.originalPointY=getCurrPoint(e)[1],1==rightTouchDown&&t&&(o.originalPointX2=getCurrPoint(t)[0],o.originalPointY2=getCurrPoint(t)[1])},Touchmove=function(e,t){var o=GetViewport(),s=o.canvas();if(!openDisplayMarkup||!getByid("DICOMTagsSelect").selected&&!getByid("AIMSelect").selected){var i=getCurrPoint(e)[0],a=getCurrPoint(e)[1];if(t&&(getCurrPoint(t)[0],getCurrPoint(t)[1]),getClass("labelXY")[viewportNumber].innerText="X: "+Math.floor(i)+" Y: "+Math.floor(a),1==rightTouchDown&&t){if(1==openLink)for(var r=0;r<Viewport_Total;r++)if(r!=viewportNumber)try{GetViewport(r).canvas().style.width=o.canvas().style.width,GetViewport(r).canvas().style.height=o.canvas().style.height,setTransform(r),GetViewport(r).NowCanvasSizeWidth=parseFloat(s.style.width),GetViewport(r).NowCanvasSizeHeight=parseFloat(s.style.height)}catch(e){}if(Math.abs(GetmouseY(t)-GetmouseY(e))-2>Math.abs(windowMouseY-windowMouseY2)+2||Math.abs(GetmouseX(t)-GetmouseX(e))-2>Math.abs(windowMouseX-windowMouseX2)+2){var n=parseFloat(s.style.width),w=parseFloat(s.style.height),l=GetViewportMark().style.width=s.style.width=1.05*n+"px",h=GetViewportMark().style.height=s.style.height=1.05*w+"px";parseFloat(l),o.newMousePointX-=Math.abs(n-parseFloat(l))/2,parseFloat(h),o.newMousePointY-=Math.abs(w-parseFloat(h))/2,setTransform()}else(Math.abs(GetmouseY(t)-GetmouseY(e))+2<Math.abs(windowMouseY-windowMouseY2)-2||Math.abs(GetmouseX(t)-GetmouseX(e))+2<Math.abs(windowMouseX-windowMouseX2)-2)&&(n=parseFloat(s.style.width),w=parseFloat(s.style.height),l=GetViewportMark().style.width=s.style.width=n/1.05+"px",h=GetViewportMark().style.height=s.style.height=w/1.05+"px",parseFloat(l),o.newMousePointX+=Math.abs(n-parseFloat(l))/2,parseFloat(h),o.newMousePointY+=Math.abs(w-parseFloat(h))/2,setTransform());if(windowMouseX=GetmouseX(e),windowMouseY=GetmouseY(e),windowMouseX2=GetmouseX(t),windowMouseY2=GetmouseY(t),o.NowCanvasSizeWidth=parseFloat(s.style.width),o.NowCanvasSizeHeight=parseFloat(s.style.height),1==openLink)for(r=0;r<Viewport_Total;r++)r!=viewportNumber&&(GetViewportMark(r).style.width=GetViewport(r).canvas().style.width=o.canvas().style.width,GetViewportMark(r).style.height=GetViewport(r).canvas().style.height=o.canvas().style.height,setTransform(r),GetViewport(r).NowCanvasSizeWidth=parseFloat(s.style.width),GetViewport(r).NowCanvasSizeHeight=parseFloat(s.style.height))}if(1==TouchDownCheck&&0==rightTouchDown){var u=GetmouseX(e),p=GetmouseY(e);if(o.newMousePointX+=u-windowMouseX,o.newMousePointY+=p-windowMouseY,setTransform(),windowMouseX=GetmouseX(e),windowMouseY=GetmouseY(e),1==openLink)for(r=0;r<Viewport_Total;r++)GetViewportMark(r).style.width=GetViewport(r).canvas().style.width=o.canvas().style.width,GetViewportMark(r).style.height=GetViewport(r).canvas().style.height=o.canvas().style.height,setTransform(r),newMousePointX[r]=o.newMousePointX,newMousePointX[r]=o.newMousePointX;for(putLabel(),r=0;r<Viewport_Total;r++)displayRuler(r)}for(putLabel(),r=0;r<Viewport_Total;r++)displayRuler(r)}},Touchend=function(e,t){1==TouchDownCheck&&(1==openAngle?openAngle=2:2==openAngle&&(openAngle=3)),TouchDownCheck=!1,rightTouchDown=!1,magnifierDiv.style.display="none"},AddMouseEvent())}